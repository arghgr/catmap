
<!DOCTYPE html>
<html>
  <head>
    <title>Mapabilly</title>
    <link rel="stylesheet" href="mapabilly.css">
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/ember.js/1.5.1/ember.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
      window.Mapp = Ember.Application.create();

      Mapp.MapInputView = Ember.View.extend({
        templateName: "map-input",
        classNames: ["map-input"],
      });

      Mapp.MapInputController = Ember.Controller.extend({
        actions: {
          submit: function() {
            var title = this.get("title");
            var latitude = this.get("latitude");
            var longitude = this.get("longitude");
            console.log("MapInputController submit - title: " + title + ", latitude: " + latitude+ ", longitude: " + longitude);
          }
        }
      });

      Mapp.MapView = Ember.View.extend({
        classNames: ["mapp"],
        markers: [
          [37.752, -122.412872, "CATS"],
          [37.751101, -122.412872, "Belugastan"]
        ],

        didInsertElement: function() {
          this.$().css({ width: "700px", height: "500px" });
          var center = new google.maps.LatLng(this.get("latitude"),this.get("longitude"));
          var mapOptions = {
            zoom: 15,
            center: center,
            scaleControl: true,
            zoomControl: true,
            zoomControlOptions: {
              style: google.maps.ZoomControlStyle.SMALL
            },
            panControl: true,
            mapTypeId: google.maps.MapTypeId.HYBRID
          };
          var map = new google.maps.Map(this.$()[0], mapOptions);

          var markers = this.get("markers");
          var googleMarkers = [];

          function addMarker(title, position, content) {
            var marker = new google.maps.Marker({
              position: position,
              map: map,
              title: title,
              draggable: false
            });
            var infowindow = new google.maps.InfoWindow({
              content: content
            });
            googleMarkers.push(marker);
            google.maps.event.addListener(marker, 'click', function(event) {
              infowindow.open(map,marker);
            });
          };

          for (i = 0; i < markers.length; i++) {
            console.log(markers[i][0], markers[i][1], markers[i][2]);
            var position = new google.maps.LatLng(markers[i][0], markers[i][1]);
            var content = markers[i][2];
            addMarker(content, position, content);
          }
        },

        willDestroyElement: function() {
          for (i in googleMarkers) {
            google.maps.event.clearInstanceListeners(googleMarkers[i]);
          }
        }
      });
    </script>
  </head>
  <body>
    
    <script type="text/x-handlebars">
      {{view Mapp.MapView latitude="37.751101" longitude="-122.412872"}}
      {{render "map-input"}}
    </script>

    <script type="text/x-handlebars" data-template-name="map-input">
      {{input type="text" value=title}}
      {{input type="text" value=latitude}}
      {{input type="text" value=longitude}}
      <button {{action "submit" this}}>Add</button>
    </script>

  </body>
</html>